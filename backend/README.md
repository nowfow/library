# Backend –º—É–∑—ã–∫–∞–ª—å–Ω–æ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–∏

Backend API –¥–ª—è —Å–∏—Å—Ç–µ–º—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º—É–∑—ã–∫–∞–ª—å–Ω–æ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–æ–π –Ω–æ—Ç –¥–ª—è –≤–∞–ª—Ç–æ—Ä–Ω—ã.

## üöÄ –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

- **REST API** –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è–º–∏, —Ç–µ—Ä–º–∏–Ω–∞–º–∏ –∏ –∫–æ–ª–ª–µ–∫—Ü–∏—è–º–∏
- **JWT –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è** –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
- **–ü–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫** –ø–æ –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è–º –∏ —Ç–µ—Ä–º–∏–Ω–∞–º
- **–§–∞–π–ª–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞** –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ PDF —Ñ–∞–π–ª–∞–º –Ω–æ—Ç
- **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –∫–æ–ª–ª–µ–∫—Ü–∏–∏** —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é —Å–æ–∑–¥–∞–Ω–∏—è –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞** –±–∏–±–ª–∏–æ—Ç–µ–∫–∏

## üìã –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Node.js 18+
- MySQL 8.0+
- npm –∏–ª–∏ yarn

## ‚öôÔ∏è –£—Å—Ç–∞–Ω–æ–≤–∫–∞

1. **–ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –ø–µ—Ä–µ—Ö–æ–¥ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é:**
```bash
cd backend
```

2. **–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π:**
```bash
npm install
```

3. **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è:**
```bash
cp .env.example .env
# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ .env —Ñ–∞–π–ª —Å –≤–∞—à–∏–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
```

4. **–°–æ–∑–¥–∞–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:**
```sql
CREATE DATABASE music_library CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
```

5. **–ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:**
```bash
node populate-db.js
```

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–û—Å–Ω–æ–≤–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ —Ñ–∞–π–ª–µ `.env`:

```env
# –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
DB_HOST=localhost
DB_PORT=3306
DB_USER=root
DB_PASSWORD=your_password
DB_NAME=music_library

# –°–µ—Ä–≤–µ—Ä
PORT=3000
NODE_ENV=development

# JWT
JWT_SECRET=your_super_secret_key
JWT_EXPIRES_IN=7d

# CORS
FRONTEND_URL=http://localhost:5173

# –§–∞–π–ª—ã
FILES_PATH=../files
```

## üèÉ‚Äç‚ôÇÔ∏è –ó–∞–ø—É—Å–∫

### –†–µ–∂–∏–º —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
```bash
npm run dev
```

### –ü—Ä–æ–¥–∞–∫—à–Ω —Ä–µ–∂–∏–º
```bash
npm start
```

## üìö API –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### –ë–∞–∑–æ–≤—ã–π URL
```
http://localhost:3000/api
```

### üîç –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã

#### Health Check
```http
GET /health
```

#### –ü—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è
```http
GET /api/works                    # –°–ø–∏—Å–æ–∫ –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–π —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π
GET /api/works/:id                # –ö–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ
GET /api/works/categories         # –°–ø–∏—Å–æ–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
GET /api/works/composers          # –°–ø–∏—Å–æ–∫ –∫–æ–º–ø–æ–∑–∏—Ç–æ—Ä–æ–≤
GET /api/works/search/advanced    # –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –ø–æ–∏—Å–∫
GET /api/works/stats/summary      # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–π
```

#### –¢–µ—Ä–º–∏–Ω—ã
```http
GET /api/terms                    # –°–ø–∏—Å–æ–∫ —Ç–µ—Ä–º–∏–Ω–æ–≤
GET /api/terms/search            # –ü–æ–∏—Å–∫ —Ç–µ—Ä–º–∏–Ω–æ–≤
GET /api/terms/:id               # –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ç–µ—Ä–º–∏–Ω
POST /api/terms                  # –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–µ—Ä–º–∏–Ω–∞
GET /api/terms/stats/summary     # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ç–µ—Ä–º–∏–Ω–æ–≤
```

#### –§–∞–π–ª—ã
```http
GET /api/files/structure         # –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤
GET /api/files/download/:path    # –°–∫–∞—á–∏–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞
GET /api/files/info/:path        # –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ñ–∞–π–ª–µ
GET /api/files/search            # –ü–æ–∏—Å–∫ —Ñ–∞–π–ª–æ–≤
GET /api/files/stats             # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ñ–∞–π–ª–æ–≤
```

#### –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
```http
POST /api/auth/register          # –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
POST /api/auth/login             # –í—Ö–æ–¥
GET /api/auth/me                 # –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
PUT /api/auth/profile            # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è
POST /api/auth/verify-token      # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–∞
POST /api/auth/refresh-token     # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞
POST /api/auth/logout            # –í—ã—Ö–æ–¥
```

#### –ö–æ–ª–ª–µ–∫—Ü–∏–∏
```http
GET /api/collections             # –ö–æ–ª–ª–µ–∫—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
GET /api/collections/public      # –ü—É–±–ª–∏—á–Ω—ã–µ –∫–æ–ª–ª–µ–∫—Ü–∏–∏
POST /api/collections            # –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–ª–ª–µ–∫—Ü–∏–∏
GET /api/collections/:id         # –ö–æ–Ω–∫—Ä–µ—Ç–Ω–∞—è –∫–æ–ª–ª–µ–∫—Ü–∏—è
PUT /api/collections/:id         # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–ª–ª–µ–∫—Ü–∏–∏
DELETE /api/collections/:id      # –£–¥–∞–ª–µ–Ω–∏–µ –∫–æ–ª–ª–µ–∫—Ü–∏–∏
POST /api/collections/:id/works  # –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è
DELETE /api/collections/:id/works/:work_id  # –£–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è
```

## üóÑÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –¢–∞–±–ª–∏—Ü—ã

#### `works` - –ü—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è
- `id` - ID –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è
- `category` - –ö–∞—Ç–µ–≥–æ—Ä–∏—è (–î–∂–∞–∑, –°–æ–Ω–∞—Ç–∞, –∏ —Ç.–¥.)
- `subcategory` - –ü–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è
- `composer` - –ö–æ–º–ø–æ–∑–∏—Ç–æ—Ä
- `work_title` - –ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è
- `file_path` - –ü—É—Ç—å –∫ —Ñ–∞–π–ª—É
- `file_type` - –¢–∏–ø —Ñ–∞–π–ª–∞ (pdf, mp3, sib, mus)
- `file_size` - –†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞
- `pages_count` - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–∞–Ω–∏—Ü (–¥–ª—è PDF)

#### `terms` - –ú—É–∑—ã–∫–∞–ª—å–Ω—ã–µ —Ç–µ—Ä–º–∏–Ω—ã
- `id` - ID —Ç–µ—Ä–º–∏–Ω–∞
- `term` - –¢–µ—Ä–º–∏–Ω
- `definition` - –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ

#### `users` - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
- `id` - ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `email` - Email
- `password_hash` - –•–µ—à –ø–∞—Ä–æ–ª—è
- `name` - –ò–º—è
- `role` - –†–æ–ª—å (user, admin)
- `is_active` - –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å

#### `user_collections` - –ö–æ–ª–ª–µ–∫—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- `id` - ID –∫–æ–ª–ª–µ–∫—Ü–∏–∏
- `user_id` - ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `name` - –ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–ª–ª–µ–∫—Ü–∏–∏
- `description` - –û–ø–∏—Å–∞–Ω–∏–µ
- `is_public` - –ü—É–±–ª–∏—á–Ω–∞—è –∫–æ–ª–ª–µ–∫—Ü–∏—è

#### `collection_works` - –°–≤—è–∑—å –∫–æ–ª–ª–µ–∫—Ü–∏–π —Å –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è–º–∏
- `collection_id` - ID –∫–æ–ª–ª–µ–∫—Ü–∏–∏
- `work_id` - ID –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è
- `added_at` - –î–∞—Ç–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è

## üîí –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

API –∏—Å–ø–æ–ª—å–∑—É–µ—Ç JWT —Ç–æ–∫–µ–Ω—ã –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏. –¢–æ–∫–µ–Ω –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ:

```http
Authorization: Bearer YOUR_JWT_TOKEN
```

## üìä –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤

### –ü–æ–∏—Å–∫ –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–π
```bash
curl "http://localhost:3000/api/works?search=Mozart&category=–ö–æ–Ω—Ü–µ—Ä—Ç&limit=10"
```

### –ü–æ–ª—É—á–µ–Ω–∏–µ —Ñ–∞–π–ª–∞
```bash
curl "http://localhost:3000/api/files/download/–ö–æ–Ω—Ü–µ—Ä—Ç—ã/Mozart/–ö–æ–Ω—Ü–µ—Ä—Ç_4.pdf"
```

### –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–ª–ª–µ–∫—Ü–∏–∏
```bash
curl -X POST "http://localhost:3000/api/collections" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"name": "–ú–æ–∏ –∏–∑–±—Ä–∞–Ω–Ω—ã–µ", "description": "–õ—é–±–∏–º—ã–µ –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è"}'
```

## üêõ –û—Ç–ª–∞–¥–∫–∞

### –õ–æ–≥–∏
–í—Å–µ –ª–æ–≥–∏ –≤—ã–≤–æ–¥—è—Ç—Å—è –≤ –∫–æ–Ω—Å–æ–ª—å. –í —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –≤–∫–ª—é—á–µ–Ω–æ –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤.

### Health Check
–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ API:
```bash
curl http://localhost:3000/health
```

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
–ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è–º:
```bash
curl http://localhost:3000/api/works/stats/summary
```

## üîß –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
```
backend/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ routes/          # –ú–∞—Ä—à—Ä—É—Ç—ã API
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.js      # –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ works.js     # –ü—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ terms.js     # –¢–µ—Ä–º–∏–Ω—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ files.js     # –§–∞–π–ª—ã
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ collections.js # –ö–æ–ª–ª–µ–∫—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ db.js           # –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î
‚îÇ   ‚îî‚îÄ‚îÄ index.js        # –û—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞–π–ª —Å–µ—Ä–≤–µ—Ä–∞
‚îú‚îÄ‚îÄ populate-db.js      # –°–∫—Ä–∏–ø—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –ë–î
‚îú‚îÄ‚îÄ package.json
‚îî‚îÄ‚îÄ .env.example
```

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤
1. –°–æ–∑–¥–∞–π—Ç–µ –º–∞—Ä—à—Ä—É—Ç –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–º —Ñ–∞–π–ª–µ –≤ `src/routes/`
2. –ò–º–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –∏ –ø–æ–¥–∫–ª—é—á–∏—Ç–µ –º–∞—Ä—à—Ä—É—Ç –≤ `src/index.js`
3. –î–æ–±–∞–≤—å—Ç–µ –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫
4. –û–±–Ω–æ–≤–∏—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é

## üöÄ –î–µ–ø–ª–æ–π

1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞
2. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ HTTPS
3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø—Ä–æ–∫—Å–∏-—Å–µ—Ä–≤–µ—Ä (nginx)
4. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å PM2 –∏–ª–∏ –∞–Ω–∞–ª–æ–≥–æ–º:

```bash
npm install -g pm2
pm2 start src/index.js --name music-library-backend
```

## üìù –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License